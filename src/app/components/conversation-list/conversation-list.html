<div class="export-section">
  <h4>Exportar todos os atendimentos</h4>
  
  <button (click)="exportAll()" [disabled]="isLoading()">
    {{ isLoading() ? 'Exportando...' : 'Exportar Todos' }}
  </button>

  <div class="date-range">
    <h5>Exportar por Período</h5>
    <div class="date-inputs">
      <div>
        <label for="startDate">De:</label>
        <input type="date" #startDate>
      </div>
      <div>
        <label for="endDate">Até:</label>
        <input type="date" #endDate>
      </div>
    </div>
    <button (click)="exportByDateRange(startDate.value, endDate.value)" [disabled]="isLoading()">
      {{ isLoading() ? 'Exportando...' : 'Exportar Período' }}
    </button>
  </div>
</div>

<div class="filter-container" style="padding: 10px 15px; border-bottom: 1px solid #ddd; background: #0e2746;">
  <label style="font-size: 0.85rem; font-weight: bold; color: #FFF; display: block; margin-bottom: 5px;">
    Filtrar por Tipo de Atendimento:
  </label>
  <select 
    [ngModel]="selectedFilter" 
    (ngModelChange)="onFilterChange($event)"
    style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.9rem;">
    <option value="">TODOS OS ATENDIMENTOS</option>
    @for (option of filterOptions; track option) {
      <option [value]="option">{{ option }}</option>
    }
  </select>
</div>

<div class="lists-wrapper">
  
  <h4 class="list-header">Fila de Atendimento</h4>
  @if (queuedConversations$ | async; as conversations) {
    @if (conversations.length === 0) {
      <div class="empty-list-label">Nenhum item na fila.</div>
    }
    <ul class="convo-list">
      @for (convo of conversations; track convo.id) {
        <li 
          class="convo-item"
          (click)="selectConversation(convo.id!, 'queued')" [class.selected]="convo.id === currentSelectedId">
          
          <div class="item-header">
            <h4>{{ convo.userName }}</h4>
            
            @if(convo.intakeData) { 
              @switch (convo.intakeData.opcaoAtendimento) {
                @case ('COMISSIONAMENTO') { <span class="service-tag tag-red">(Comissionamento (5))</span> }
                @case ('VERIFICAR COMUNICAÇÃO') { <span class="service-tag tag-blue">(Verificar Comunicação (1))</span> }
                @case ('CADASTRO DE PORTA HUGHES') { <span class="service-tag tag-green">(Cadastro Hughes(3))</span> }
                @case ('TROCA DE PORTA GPRS') { <span class="service-tag tag-orange">(Troca GPRS(2))</span> }
                @case ('TROCA DE TECNOLOGIA DE COMUNICAÇÃO') { <span class="service-tag tag-purple">(Troca Cominiação(4))</span> }
                @case ('VOLTAR COMUNICAÇÃO') { <span class="service-tag tag-yellow">(Voltar Comunicação(6))</span> }
                @default { <span class="service-tag tag-grey">(Outro)</span> }
              }
            }
          </div>
          
          <p>{{ convo.lastMessage?.text }}</p>
        </li>
      }
    </ul>
  } @else {
    <div class="loading">Carregando fila...</div>
  }


  <h4 class="list-header">Meus Atendimentos</h4>
  @if (activeConversations$ | async; as conversations) {
    @if (conversations.length === 0) {
      <div class="empty-list-label">Nenhum atendimento ativo.</div>
    }
    <ul class="convo-list">
      @for (convo of conversations; track convo.id) {
        <li 
          class="convo-item"
          (click)="selectConversation(convo.id!, 'active')" [class.selected]="convo.id === currentSelectedId"
          [ngClass]="{ 'closed': convo.status === 'closed' }">
          
          <div class="item-header">
            <h4>{{ convo.userName }}</h4>
            
            @if(convo.intakeData) {
              @switch (convo.intakeData.opcaoAtendimento) {
                @case ('COMISSIONAMENTO') { <span class="service-tag tag-red">(Comissionamento)</span> }
                @case ('VERIFICAR COMUNICAÇÃO') { <span class="service-tag tag-blue">(Verificar Com.)</span> }
                @case ('CADASTRO DE PORTA HUGHES') { <span class="service-tag tag-green">(Cadastro Hughes)</span> }
                @case ('TROCA DE PORTA GPRS') { <span class="service-tag tag-orange">(Troca GPRS)</span> }
                @case ('TROCA DE TECNOLOGIA DE COMUNICAÇÃO') { <span class="service-tag tag-purple">(Troca Tec.)</span> }
                @case ('VOLTAR COMUNICAÇÃO') { <span class="service-tag tag-yellow">(Voltar Com.)</span> }
                @default { <span class="service-tag tag-grey">(Outro)</span> }
              }
            }
          </div>
          
          <p>{{ convo.lastMessage?.text }}</p>
        </li>
      }
    </ul>
  } @else {
    <div class="loading">Carregando atendimentos...</div>
  }
  
</div>